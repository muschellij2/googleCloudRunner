<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Setup • googleCloudRunner</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Setup">
<meta property="og:description" content="googleCloudRunner">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-47480439-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-47480439-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">googleCloudRunner</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-wrench"></span>
     
    Setup
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/setup.html">R Setup</a>
    </li>
    <li>
      <a href="../articles/setup-gcp.html">GCP Setup</a>
    </li>
    <li>
      <a href="../articles/git.html">Git Setup</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/cloudbuild.html">
    <span class="fa fa-shapes"></span>
     
    Cloud Build
  </a>
</li>
<li>
  <a href="../articles/cloudrun.html">
    <span class="fa fa-running"></span>
     
    Cloud Run
  </a>
</li>
<li>
  <a href="../articles/cloudscheduler.html">
    <span class="fa fa-clock"></span>
     
    Cloud Scheduler
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-hands-helping"></span>
     
    Use Cases
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/usecase-r-api-microservices.html">R API Microservices</a>
    </li>
    <li>
      <a href="../articles/usecase-shiny-cloudrun.html">Deploy Shiny on Cloud Run</a>
    </li>
    <li>
      <a href="../articles/usecase-shiny-kubernetes.html">Deploy Shiny on Kubernetes</a>
    </li>
    <li>
      <a href="../articles/usecase-package-docker-build.html">R Package Tools: Auto Docker images</a>
    </li>
    <li>
      <a href="../articles/usecase-testthat-coverage.html">R Package Tools: Testthat coverage</a>
    </li>
    <li>
      <a href="../articles/usecase-deploy-pkgdown-website.html">R Package Tools: Pkgdown websites</a>
    </li>
    <li>
      <a href="../articles/usecase-scheduled-r-builds.html">Scheduled R scripts in the Cloud</a>
    </li>
    <li>
      <a href="../articles/usecase-r-results-github.html">Save R output to GitHub</a>
    </li>
    <li>
      <a href="../articles/usecase-polygot-ga-imports-to-bigquery.html">Integrating R with other languages</a>
    </li>
    <li>
      <a href="../articles/usecase-r-event-driven-pubsub.html">Event-triggered R scripts with pub/sub</a>
    </li>
    <li>
      <a href="../articles/usecase-slackbot-google-analytics.html">Create a Slackbot downloading Google Analytics</a>
    </li>
    <li>
      <a href="../articles/usecase-scheduled-google-analytics.html">Schedule Google Analytics User Deletion API</a>
    </li>
    <li>
      <a href="../articles/usecase-rmarkdown-cloudrun.html">On-demand parameterised R Markdown reports</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-question"></span>
     
    Functions
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MarkEdmondson1234/googleCloudRunner/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Setup</h1>
            
            <h4 data-toc-skip class="date">2022-03-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MarkEdmondson1234/googleCloudRunner/blob/HEAD/vignettes/setup.Rmd" class="external-link"><code>vignettes/setup.Rmd</code></a></small>
      <div class="hidden name"><code>setup.Rmd</code></div>

    </div>

    
    
<p>A video walk-through is available below, on <a href="https://www.youtube.com/watch?v=RrYrMsoIXsw" class="external-link">how to set-up
googleCloudRunner’s Google Console and R environment</a>:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/RrYrMsoIXsw?start=898" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<div class="section level2">
<h2 id="manual-setup">Manual setup<a class="anchor" aria-label="anchor" href="#manual-setup"></a>
</h2>
<p>You can setup the configurations directly using the below R
functions:</p>
<ul>
<li><code><a href="../reference/cr_region_set.html">cr_region_set()</a></code></li>
<li><code><a href="../reference/cr_project_set.html">cr_project_set()</a></code></li>
<li><code><a href="../reference/cr_bucket_set.html">cr_bucket_set()</a></code></li>
<li><code><a href="../reference/cr_email_set.html">cr_email_set()</a></code></li>
</ul>
<p>But it is recommended to use the environment arguments below.</p>
</div>
<div class="section level2">
<h2 id="setup-wizard-cr_setup">Setup wizard cr_setup()<a class="anchor" aria-label="anchor" href="#setup-wizard-cr_setup"></a>
</h2>
<p>There is a setup function to help you configure the package. Get
started via the commands below:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://code.markedmondson.me/googleCloudRunner/">googleCloudRunner</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/cr_setup.html">cr_setup</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#ℹ ==Welcome to googleCloudRunner setup==</span>
<span class="co">#This wizard will scan your system for setup options and help you setup any that are missing.</span>
<span class="co">#Hit 0 or ESC to cancel.</span>
<span class="co">#</span>
<span class="co">#1: Configure/check all googleCloudRunner settings</span>
<span class="co">#2: Configure GCP Project Id</span>
<span class="co">#3: Configure Authentication JSON file</span>
<span class="co">#4: Configure Cloud Storage bucket</span>
<span class="co">#5: Configure Cloud Run region</span>
<span class="co">#6: Configure Cloud Scheduler build email</span></code></pre></div>
<p>It will walk you through the details below. You can also use it to
check your settings.</p>
<div class="section level3">
<h3 id="cr_setup_auth-and-cr_setup_service">cr_setup_auth() and cr_setup_service()<a class="anchor" aria-label="anchor" href="#cr_setup_auth-and-cr_setup_service"></a>
</h3>
<p>You can configure authentication separately, as its usually the
trickiest bit. The <code><a href="../reference/cr_setup_auth.html">cr_setup_auth()</a></code> function attempts to
help you walk through the authentication and after running it and
restarting R a couple of times you should only need to download a client
ID from your project to have it all configured for you.</p>
<p>If you are customising things then <code><a href="../reference/cr_setup_service.html">cr_setup_service()</a></code>
may be useful, which lets you add common roles to the service account
emails. The other setup functions call it to set things up for you, but
you may want more control, or have special needs for your cloudbuild
email for example, which needs roles assigned for certain services you
want to build.</p>
</div>
<div class="section level3">
<h3 id="cr_setup_test">cr_setup_test()<a class="anchor" aria-label="anchor" href="#cr_setup_test"></a>
</h3>
<p>Once you get all green ticks in <code><a href="../reference/cr_setup.html">cr_setup()</a></code> then you
should be able to run the subset of the package unit tests via
<code><a href="../reference/cr_setup_test.html">cr_setup_test()</a></code>. Should those all complete then you should
be able to run any of the functions in the package!</p>
</div>
</div>
<div class="section level2">
<h2 id="r-settings">R Settings<a class="anchor" aria-label="anchor" href="#r-settings"></a>
</h2>
<div class="section level3">
<h3 id="r-environment-arguments-to-set">R environment arguments to set:<a class="anchor" aria-label="anchor" href="#r-environment-arguments-to-set"></a>
</h3>
<ul>
<li>Reuses environment argument <code>GCE_AUTH_FILE</code> from <a href="https://cloudyr.github.io/googleComputeEngineR" class="external-link">googleComputeEngineR</a>
which holds location of your service auth JSON</li>
<li>Reuses environment argument <code>GCE_DEFAULT_PROJECT_ID</code> from
googleComputeEngineR</li>
<li>Reuses environment argument <code>GCS_DEFAULT_BUCKET</code> from <a href="http://code.markedmondson.me/googleCloudStorageR/" class="external-link">googleCloudStorageR</a>
</li>
<li>New environment argument <code>CR_BUILD_EMAIL</code> that is a
Google service email (see <a href="articles/setup-gcp.html">GCP
setup</a>)</li>
<li>New environment argument <code>CR_REGION</code> can be one of the
regions listed in <code><a href="../reference/cr_regions.html">googleCloudRunner::cr_regions</a></code>
</li>
</ul>
<p>e.g. at the end of all set-up your <code>.Renviron</code> should look
like:</p>
<pre><code><span class="va">GCE_AUTH_FILE</span><span class="op">=</span><span class="st">"/Users/me/auth/auth.json"</span>
<span class="va">GCE_DEFAULT_PROJECT_ID</span><span class="op">=</span><span class="st">"my-project"</span>
<span class="va">GCS_DEFAULT_BUCKET</span><span class="op">=</span><span class="st">"my-bucket"</span>
<span class="va">CR_REGION</span><span class="op">=</span><span class="st">"europe-west1"</span>
<span class="va">CR_BUILD_EMAIL</span><span class="op">=</span><span class="va">googlecloudrunner</span><span class="op">@</span><span class="va">your</span><span class="op">-</span><span class="va">project.iam.gserviceaccount.com</span></code></pre>
<p>And when you restart R and load the library you should see something
like:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(googleCloudRunner)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>✓ Setting scopes to https<span class="sc">:</span><span class="er">//</span>www.googleapis.com<span class="sc">/</span>auth<span class="sc">/</span>cloud<span class="sc">-</span>platform</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>✓ Successfully auto<span class="sc">-</span>authenticated via <span class="sc">/</span>Users<span class="sc">/</span>me<span class="sc">/</span>auth<span class="sc">/</span>keys<span class="sc">/</span>googlecloudrunner<span class="sc">-</span>auth<span class="sc">-</span>key.json</span></code></pre></div>
<p>This <code>.Renviron</code> file can be placed in the root of your
project or as per what is described in <code><a href="https://rdrr.io/r/base/Startup.html" class="external-link">?Startup</a></code>.</p>
<p>You can also set the above in the R scripts via:</p>
<ul>
<li><code><a href="../reference/cr_region_set.html">cr_region_set()</a></code></li>
<li><code><a href="../reference/cr_project_set.html">cr_project_set()</a></code></li>
<li><code><a href="../reference/cr_bucket_set.html">cr_bucket_set()</a></code></li>
<li><code><a href="../reference/cr_email_set.html">cr_email_set()</a></code></li>
</ul>
<p>Or authenticate via</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">googleAuthR</span><span class="fu">::</span><span class="fu">gar_service_auth</span><span class="op">(</span><span class="st">"my_auth_json.com"</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Mark Edmondson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
